FROM node:18.7.0
COPY . /micro-service
COPY ./package.json /micro-service
WORKDIR /micro-service
RUN npm install -g pnpm && \
    pnpm install && \
    pnpm build && \
    cp ./dist/apps/micro-service ./dist/ -r && \
    rm -rf ./dist/apps && \
    rm -rf ./apps/back && \
    rm -rf ./apps/pic
ENV REIDS_HOST=172.18.0.4
ENV MONGO_PATH=mongodb://127.18.0.5:27017/
EXPOSE 3002
CMD ["node", "./dist/micro-service/main.js"]